<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexa AI - Digital Ledger</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .app-card { background: white; width: 100%; max-width: 360px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); overflow: hidden; border: 1px solid #ddd; }
        .header { background: linear-gradient(135deg, #1e3c72, #2a5298); color: white; padding: 25px; text-align: center; }
        .balance-section { background: #27ae60; color: white; margin: 20px; padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 4px 10px rgba(39, 174, 96, 0.3); }
        .feature-box { border: 2px dashed #bdc3c7; margin: 20px; padding: 15px; border-radius: 15px; position: relative; transition: 0.3s; }
        .locked { filter: blur(4px); opacity: 0.6; pointer-events: none; }
        .status-badge { text-align: center; font-weight: bold; padding: 10px; font-size: 13px; border-radius: 5px; margin: 0 20px; }
        .btn { display: block; width: 85%; margin: 15px auto; padding: 14px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-main { background: #3498db; color: white; }
        .btn-premium { background: #8e44ad; color: white; }
    </style>
</head>
<body>

<div class="app-card">
    <div class="header">
        <h2 style="margin:0;">Khagesh ai-nexa</h2>
        <p style="margin:5px 0 0; opacity:0.8;">Smart Digital Ledger</p>
    </div>

    <div class="balance-section">
        <p style="margin:0; font-size:14px;">Current Balance</p>
        <h1 id="balance" style="margin:5px 0 0;">‚Çπ 0</h1>
    </div>

    <div id="premium-area" class="feature-box locked">
        <div style="position:absolute; top:40%; left:25%; color:#c0392b; font-weight:bold; z-index:10;" id="lock-label">üîí Locked Feature</div>
        <p style="margin:0;">üìÑ <b>Invoice PDF Download</b></p>
        <button class="btn btn-premium">Generate Invoice</button>
    </div>

    <div id="status" class="status-badge" style="color: #e67e22; background: #fff3e0;">
        üîÑ Connecting to Nexa AI...
    </div>

    <button class="btn btn-main" style="margin-top:20px; background:#2c3e50;" onclick="alert('Starting balance is 0 as per business rules.')">
        + Add New Transaction
    </button>
</div>

<script>
    // Supabase Configuration (Aapki Keys Fit kar di hain)
    const supabaseUrl = 'https://onlbikroyrgmolyxbbl.supabase.co'; 
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9ubGJpa3JveXJnbW9seWJ4YmJsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5NzQ0NzIsImV4cCI6MjA4NDU1MDQ3Mn0.8R_YdbdMeDQ0qn0j-3TOs6KRWR9k4WWxExCnBYOIFEM';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    async function syncNexaApp() {
        const { data, error } = await supabase
            .from('profiles')
            .select('*')
            .eq('id', 1)
            .single();

        if (error) {
            document.getElementById('status').innerText = "‚ö†Ô∏è Connection Error";
            return;
        }

        if (data) {
            // Balance Update
            document.getElementById('balance').innerText = "‚Çπ " + data.balance;

            // Premium Logic
            if (data.is_premium === true) {
                document.getElementById('premium-area').classList.remove('locked');
                document.getElementById('lock-label').style.display = 'none';
                document.getElementById('status').innerText = "‚úÖ Premium Active";
                document.getElementById('status').style.color = "green";
                document.getElementById('status').style.background = "#e8f5e9";
            } else {
                document.getElementById('status').innerText = "‚ùå Subscription Expired: Pay ‚Çπ499";
                document.getElementById('status').style.color = "#c0392b";
            }
        }
    }

    // Har 5 second mein update check karega
    syncNexaApp();
    setInterval(syncNexaApp, 5000);
</script>

</body>
</html>
